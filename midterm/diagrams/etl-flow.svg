<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960 520" font-family="'Segoe UI', Arial, sans-serif">
  <defs>
    <marker id="arrow-etl" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#555"/>
    </marker>
    <filter id="shadow-etl" x="-2%" y="-2%" width="104%" height="104%">
      <feDropShadow dx="1" dy="1" stdDeviation="2" flood-opacity="0.12"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="480" y="28" text-anchor="middle" font-size="17" font-weight="bold" fill="#2c3e50">ETL Pipeline — From Operational Databases to Star-Schema Warehouse</text>

  <!-- ========== EXTRACT (left column) ========== -->
  <text x="120" y="65" text-anchor="middle" font-size="15" font-weight="bold" fill="#2980b9">EXTRACT</text>
  <text x="120" y="82" text-anchor="middle" font-size="10" fill="#888">Read from source databases</text>

  <!-- sales-db box -->
  <g filter="url(#shadow-etl)">
    <rect x="20" y="100" width="200" height="120" rx="6" fill="#fff" stroke="#2980b9" stroke-width="2"/>
    <rect x="20" y="100" width="200" height="30" rx="6" fill="#2980b9"/>
    <rect x="20" y="120" width="200" height="10" fill="#2980b9"/>
    <text x="120" y="121" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">sales-db (PostgreSQL)</text>
    <text x="35" y="150" font-size="11" fill="#333">customers (8 rows)</text>
    <text x="35" y="168" font-size="11" fill="#333">products (10 rows)</text>
    <text x="35" y="186" font-size="11" fill="#333">orders (20 rows)</text>
    <text x="35" y="210" font-size="10" fill="#888">Normalized — 3NF</text>
  </g>

  <!-- hr-db box -->
  <g filter="url(#shadow-etl)">
    <rect x="20" y="245" width="200" height="120" rx="6" fill="#fff" stroke="#27ae60" stroke-width="2"/>
    <rect x="20" y="245" width="200" height="30" rx="6" fill="#27ae60"/>
    <rect x="20" y="265" width="200" height="10" fill="#27ae60"/>
    <text x="120" y="266" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">hr-db (PostgreSQL)</text>
    <text x="35" y="295" font-size="11" fill="#333">departments (4 rows)</text>
    <text x="35" y="313" font-size="11" fill="#333">employees (12 rows)</text>
    <text x="35" y="331" font-size="11" fill="#333">timesheets (many rows)</text>
    <text x="35" y="355" font-size="10" fill="#888">Normalized — 3NF</text>
  </g>

  <!-- ========== TRANSFORM (center column) ========== -->
  <text x="480" y="65" text-anchor="middle" font-size="15" font-weight="bold" fill="#e67e22">TRANSFORM</text>
  <text x="480" y="82" text-anchor="middle" font-size="10" fill="#888">Clean, reshape, denormalize in Python</text>

  <!-- etl_script.py box -->
  <g filter="url(#shadow-etl)">
    <rect x="340" y="130" width="280" height="210" rx="6" fill="#fff" stroke="#e67e22" stroke-width="2"/>
    <rect x="340" y="130" width="280" height="30" rx="6" fill="#e67e22"/>
    <rect x="340" y="150" width="280" height="10" fill="#e67e22"/>
    <text x="480" y="151" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">etl_script.py</text>

    <text x="355" y="180" font-size="11" fill="#555" font-weight="bold">Step 1: Generate dim_date</text>
    <text x="370" y="196" font-size="10" fill="#333">Every day of 2026, pre-calculate</text>
    <text x="370" y="210" font-size="10" fill="#333">quarter, month_name, is_weekend, etc.</text>

    <text x="355" y="232" font-size="11" fill="#555" font-weight="bold">Step 2: Load dimensions</text>
    <text x="370" y="248" font-size="10" fill="#333">customers → dim_customer (surrogate key)</text>
    <text x="370" y="262" font-size="10" fill="#333">products → dim_product (surrogate key)</text>
    <text x="370" y="276" font-size="10" fill="#e74c3c">employees + departments → dim_employee</text>
    <text x="370" y="290" font-size="10" fill="#e74c3c">  (JOIN + denormalize dept info)</text>

    <text x="355" y="312" font-size="11" fill="#555" font-weight="bold">Step 3: Load fact_sales</text>
    <text x="370" y="328" font-size="10" fill="#333">Map source IDs → surrogate keys</text>
  </g>

  <!-- Idempotent label -->
  <rect x="370" y="348" width="220" height="22" rx="4" fill="#f0f0f0" stroke="#ccc" stroke-width="1"/>
  <text x="480" y="363" text-anchor="middle" font-size="10" fill="#555">ON CONFLICT → idempotent (safe to re-run)</text>

  <!-- ========== LOAD (right column) ========== -->
  <text x="840" y="65" text-anchor="middle" font-size="15" font-weight="bold" fill="#c0392b">LOAD</text>
  <text x="840" y="82" text-anchor="middle" font-size="10" fill="#888">Insert into warehouse tables</text>

  <!-- warehouse-db box -->
  <g filter="url(#shadow-etl)">
    <rect x="700" y="100" width="240" height="270" rx="6" fill="#fff" stroke="#c0392b" stroke-width="2"/>
    <rect x="700" y="100" width="240" height="30" rx="6" fill="#c0392b"/>
    <rect x="700" y="120" width="240" height="10" fill="#c0392b"/>
    <text x="820" y="121" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">warehouse-db (PostgreSQL)</text>

    <text x="715" y="150" font-size="11" fill="#2980b9" font-weight="bold">dim_date</text>
    <text x="810" y="150" font-size="10" fill="#888">365 rows (all of 2026)</text>

    <text x="715" y="175" font-size="11" fill="#27ae60" font-weight="bold">dim_customer</text>
    <text x="820" y="175" font-size="10" fill="#888">8 rows</text>

    <text x="715" y="200" font-size="11" fill="#e67e22" font-weight="bold">dim_product</text>
    <text x="820" y="200" font-size="10" fill="#888">10 rows</text>

    <text x="715" y="225" font-size="11" fill="#8e44ad" font-weight="bold">dim_employee</text>
    <text x="820" y="225" font-size="10" fill="#888">12 rows</text>
    <text x="725" y="242" font-size="9" fill="#e74c3c">dept_name, dept_location denormalized</text>

    <line x1="710" y1="255" x2="930" y2="255" stroke="#eee" stroke-width="1"/>

    <text x="715" y="275" font-size="11" fill="#c0392b" font-weight="bold">fact_sales</text>
    <text x="820" y="275" font-size="10" fill="#888">20 rows</text>
    <text x="725" y="292" font-size="9" fill="#555">FKs → dim_date, dim_customer, dim_product</text>
    <text x="725" y="308" font-size="9" fill="#16a085">Measures: quantity, unit_price, total_price</text>

    <text x="715" y="335" font-size="10" fill="#555" font-style="italic">Star Schema — denormalized</text>
    <text x="715" y="350" font-size="10" fill="#555" font-style="italic">for fast analytical queries</text>
  </g>

  <!-- ========== ARROWS ========== -->
  <!-- sales-db → etl_script -->
  <line x1="220" y1="160" x2="340" y2="200" stroke="#2980b9" stroke-width="2" marker-end="url(#arrow-etl)"/>
  <text x="268" y="170" font-size="9" fill="#2980b9">SELECT *</text>

  <!-- hr-db → etl_script -->
  <line x1="220" y1="305" x2="340" y2="270" stroke="#27ae60" stroke-width="2" marker-end="url(#arrow-etl)"/>
  <text x="255" y="300" font-size="9" fill="#27ae60">SELECT + JOIN</text>

  <!-- etl_script → warehouse-db -->
  <line x1="620" y1="235" x2="700" y2="235" stroke="#c0392b" stroke-width="2.5" marker-end="url(#arrow-etl)"/>
  <text x="645" y="225" font-size="9" fill="#c0392b">INSERT</text>

  <!-- ========== Legend ========== -->
  <rect x="20" y="400" width="920" height="105" rx="6" fill="#f8f9fa" stroke="#ddd" stroke-width="1"/>
  <text x="40" y="425" font-size="13" font-weight="bold" fill="#2c3e50">How It All Connects</text>

  <text x="40" y="448" font-size="11" fill="#555">1. The ETL script connects to both operational databases (sales-db, hr-db) and reads their normalized tables.</text>
  <text x="40" y="468" font-size="11" fill="#555">2. It transforms the data: generates the date dimension, maps source IDs to surrogate keys, and denormalizes department info into dim_employee.</text>
  <text x="40" y="488" font-size="11" fill="#555">3. It loads the transformed data into the warehouse's star schema — dimensions first, then facts (so FK references are valid).</text>
</svg>
